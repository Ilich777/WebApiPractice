<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Войти</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <link rel="stylesheet" href="css/style_for_authhtml.css">
        <link rel="icon" href="img/icon.ico" type="image/x-icon">
        <link rel="shortcut icon" href="img/icon.ico" type="image/x-icon">
</head>
<body>
    <form method="post" action="" class="login">
        <p>
            <label for="login">Логин:</label>
            <input type="text" name="login" id="login" placeholder="name@example.com">
        </p>

        <p>
            <label for="password">Пароль:</label>
            <input type="password" name="password" id="password" placeholder="123456789">
        </p>

        <p class="login-submit">
            <button type="button" class="login-button" id="enter">Войти</button>
        </p>

        <p class="forgot-password"><a href="index.html">Забыл пароль?</a></p>
    </form>
    <script type="text/javascript">
        $('#enter').click(function (e) {

                const response = await fetch("/login", {
                    method: "POST",
                    headers: { "Accept": "application/json", "Content-Type": "application/json" },
                    body: JSON.stringify({
                        division: $("#div").val(),
                        service: $("#ser").val(),
                        date: $("#date").val(),
                        time: $("#time").val()
                    })
                })
                /*.then(data => {
                identifier = data.json,
                    console.log(identifier)
            });*/

                if (response.ok === true) {
                    const user = await response.json();

                    console.log(user);
                    identifier = user;
                    //console.log(identifier);
                }
                else {
                    e.preventDefault();
                    const errorData = await response.json();
                    console.log("errors", errorData);
                    if (errorData) {
                        // ошибки вследствие валидации по атрибутам
                        if (errorData.errors) {
                            if (errorData.errors["division"]) {
                                addError(errorData.errors["division"]);
                            }
                        }
                        // кастомные ошибки, определенные в контроллере
                        // добавляем ошибки свойства Name
                        if (errorData["division"]) {
                            addError(errorData["division"]);
                        }

                    }

                    document.getElementById("errors").style.display = "block";
                }


        
        });
    </script>
</body>
</html>