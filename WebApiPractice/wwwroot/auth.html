<!DOCTYPE html>
<html>
<head>
    <script src="js/jquery-3.3.1.min.js"></script>
    <meta charset="utf-8" />
    <title>Войти</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <link rel="stylesheet" href="css/style_for_authhtml.css">
    <link rel="icon" href="img/icon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="img/icon.ico" type="image/x-icon">
</head>
<body>
    <form method="post" action="" class="login">
        <p>
            <label for="login">Логин:</label>
            <input type="text" name="login" id="login" placeholder="name@example.com">
        </p>

        <p>
            <label for="password">Пароль:</label>
            <input type="password" name="password" id="password" placeholder="123456789">
        </p>

        <p class="login-submit">
            <button type="button" class="login-button" id="enter">Войти</button>
        </p>

            <button type="button" class="" id="send_token">Токен</button>


        <p class="forgot-password"><a href="index.html">Забыл пароль?</a></p>
    </form>
    <script type="text/javascript">
        
        var token;
        async function send_dataset(url) {
            
            var data = JSON.stringify({
                username: $("#login").val(),
                password: $("#password").val()
            });
            const response = await fetch(url, {
                method: "POST",
                headers: { "Accept": "application/json", "Content-Type": "application/json" },
                body: data

            });

            if (response.ok === true) {
                const user = await response.json();
                token = user.token;
                alert(token);
                //const d = new Date();
                //d.setTime(d.getTime() + (24 * 60 * 60 * 1000));
                //let expires = "expires=" + d.toUTCString();
                //document.cookie = "user=" + token + ";" + expires + ";path=/";
            }

        }
        async function get_access(url) {

            alert(token);
            const response = await fetch(url, {
                method: "GET",
                headers: {
                    "Accept": "application/json; charset=utf-8",
                    "Authorization": `Bearer ${token}`  // передача токена в заголовке*/
                },
                //credentials: 'same-origin'

            });
            if (response.ok === true) {

                const data = await response.json();
                console.log(data);
            }
            else
                console.log("Status: ", response.status);
        }

        $('#enter').click(function (e) {
            send_dataset("/api/authenticate/login");
        });
        $('#send_token').click(function (e) {
            get_access("/authorize/get_access");
        });
        
        
    </script>
</body>
</html>